{# bouton pour enclencher la modale #}
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#drawModal">
  Créer un Tirage
</button>

{# modale #}
<div class="modal fade" id="drawModal" tabindex="-1" aria-labelledby="drawModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form class="form-inline" id="add-members-form" method="POST" action="{{ path('draw_new') }}">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="drawModalLabel">Ajouter des participants</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div class="modal-body">
                    <label for="participant-select">Participants</label>
                    <select class="form-select" id="participant-select" style="width:100%;">
                        {% for user in users %}
                            <option value="{{ user.id }}" id="valueOption">{{ user.username }}</option>
                        {% endfor %}
                    </select>

                    <div class="form-check mb-3">
                      <input class="form-check-input" type="checkbox" value="" id="allUsers">
                      <label class="form-check-label" for="allUsers">
                        Ajouter tous les utilisateurs
                      </label>
                    </div>

                    <div class="btn-add mt-2">
                        <button class="btn btn-primary" id="add" type="button">+ Ajouter</button>
                    </div>

                    <ul id="members-list" class="mt-3"></ul>

                    <input type="hidden" name="participants" id="selected-participants">
                </div>

                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">Enregistrer la liste</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                </div>
            </form>
        </div>
    </div>
</div>








<script>
document.addEventListener("DOMContentLoaded", function () {
    const addBtn = document.getElementById("add");
    const select = document.getElementById("participant-select");
    const membersList = document.getElementById("members-list");
    const hiddenInput = document.getElementById("selected-participants");
    const selectBox = document.getElementById("allUsers");

    let selectedIds = [];

    // Gérer le changement d'état de la checkbox (optionnel)
    selectBox.addEventListener("change", function () {
        select.disabled = this.checked;
    });

    addBtn.addEventListener("click", function () {
        const allOptions = Array.from(select.options);

        if (selectBox.checked) {
            allOptions.forEach(option => {
                const id = option.value;
                const name = option.text;

                if (!selectedIds.includes(id)) {
                    selectedIds.push(id);

                    const li = document.createElement("li");
                    li.textContent = name;
                    membersList.appendChild(li);
                }
            });
        } else {
            const selectedOption = select.options[select.selectedIndex];
            const userId = selectedOption.value;
            const username = selectedOption.text;


                selectedIds.push(userId);

                const li = document.createElement("li");
                li.textContent = username;
                membersList.appendChild(li);

        }

        // Mettre à jour l'input caché avec les IDs sélectionnés
        hiddenInput.value = selectedIds.join(',');
    });
});
</script>
